# Project 8: Stock Data Visualizer Agent

## 1. Project Overview

This project implements a **Financial Analysis & Visualization Pipeline**. It solves the problem of retrieving accurate market data and generating professional charts without writing manual plotting scripts.

**Goal:** Take a plain English company name (e.g., "Nvidia"), autonomously find its ticker symbol, download historical data, and generate a polished multi-line stock price chart.

---

## 2. The Agentic Workflow

This system combines **Tool Use** (to get real data) with **Code Generation** (to visualize it). It uses a "Code-Reviewer" pattern where subsequent agents fix and polish the code generated by previous agents.

### The Pipeline:

1. **The Ticker Scout (Agent 1):**
* **Input:** Company Name (e.g., "Nvidia").
* **Action:** Identifies the correct stock symbol ("NVDA"). If it can't find it, it returns "N/A".


2. **The Data Miner (Agent 2):**
* **Role:** Tool User.
* **Action:** It has access to `yfinance` functions. It calls `get_current_date` and `get_stock_data` to fetch historical prices from 2020 to the present.
* **Output:** Returns the raw data as a Pandas DataFrame string.


3. **The Coder (Agent 3):**
* **Role:** Python Developer.
* **Action:** Writes a Python script to visualize the data using `matplotlib` or `pandas`. It creates plots for Open, High, Low, and Close prices.


4. **The Debugger (Agent 4):**
* **Role:** QA Engineer.
* **Action:** Reviews the raw code from Agent 3 to ensure syntax is correct and variables match the DataFrame structure. Fixes potential errors.


5. **The Designer (Agent 5):**
* **Role:** Data Viz Expert.
* **Action:** Performs a final "Advanced Refinement," improving color coordination, axis labeling, and chart aesthetics before the code is finally executed.



---

## 3. Code Breakdown

### Key Functions

| Function Name | Agent Role | Description |
| --- | --- | --- |
| `stock_symbol_extractor` | **Scout** | Maps "Company Name"  "Symbol". Essential because APIs require symbols (NVDA), not names. |
| `stock_data_extractor` | **Miner** | **Tool-Use Agent.** Uses a `while` loop to call Python functions (`get_stock_data`) and retrieve real-world data. |
| `visualize_data` | **Coder** | Generates the initial raw Python script to plot the data. |
| `refine_code` | **Debugger** | Takes the raw code and fixes syntax errors or logical bugs (e.g., ensuring string-to-float conversion). |
| `refine_advanced_code` | **Designer** | Polishes the visual output (legends, colors, grid lines) for a professional look. |

### Technical Details

* **Tool Definition:** The project defines a `TOOL_MAPPING` dictionary and a JSON schema (`tool_def`) that allows the LLM to understand how to call `yfinance`.
* **Dynamic Execution (`exec`):** The system uses Python's `exec()` function to run the code generated by the LLM. This allows the agent to essentially "write its own software" to solve the user's request.
* **Data Serialization:** The DataFrame is converted to a string representation so it can be passed into the LLM's context window, then reconstructed back into a DataFrame using `pd.read_csv(StringIO(...))`.

---

## 4. Why is this "Agentic"?

A standard script requires you to hard-code the ticker and the plotting logic.

**This system is Agentic because:**

1. **It Bridges Knowledge Gaps:** You don't need to know the stock symbol; the agent figures it out.
2. **It Uses External Tools:** It doesn't hallucinate stock prices; it connects to the Yahoo Finance API to get the truth.
3. **It Self-Corrects:** If the initial plotting code is buggy (e.g., wrong column names), the refinement agents (4 & 5) catch and fix it before execution.

---

## 5. How to Run

**Prerequisites:**

* `pip install yfinance pandas matplotlib aisuite python-dotenv`

```python
# 1. Define Company
company = "Nvidia"

# 2. Get Symbol
print(f"--- üîç Finding Symbol for {company} ---")
symbol = stock_symbol_extractor(company) # Returns "NVDA"

# 3. Get Data (Agent uses Tools)
print(f"--- üìâ Fetching Data for {symbol} ---")
raw_data_str = stock_data_extractor(symbol)
# Convert string back to DataFrame for local use
df = pd.read_csv(StringIO(raw_data_str), delim_whitespace=True)

# 4. Generate Visualization Code
print("--- üé® Generating Plot Code ---")
initial_code = visualize_data(company, raw_data_str)

# 5. Refine & Polish
print("--- üõ†Ô∏è Refining Code ---")
fixed_code = refine_code(initial_code)
final_code = refine_advanced_code(fixed_code, raw_data_str)

# 6. Execute to See Chart
print("--- üöÄ Executing Final Code ---")
# The code will assume 'df' or 'stock_data_string' exists in the context
# You might need to alias your dataframe variable to match what the LLM expects
stock_data_string = df 
exec(final_code)

```

